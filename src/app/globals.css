@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --chart-1: 265 90% 70%;
    --chart-2: 300 90% 70%;
    --chart-3: 198 93% 60%;
    --chart-4: 283 100% 41%;
    --chart-5: 342.1 92.5% 61.4%;

    --cor-fisico: #E04A2F;
    --cor-mental: #3A7BE0;
    --cor-social: #5E8C4F;
  }

  .dark {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 85.7% 97.3%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --radius: 0.5rem;
  }
}

@layer base {
  html {
    @apply bg-background;
  }
  html::-webkit-scrollbar {
    display: none;
  }

  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    background: radial-gradient(ellipse at bottom, hsl(var(--background)) 0%, hsl(var(--background) / 0.9) 70%, transparent 100%);
  }
}

@layer components {
  .glassmorphic-card {
    @apply bg-card/50 backdrop-blur-lg border border-white/10 shadow-lg transition-all duration-300;
  }

  .glassmorphic-card:hover {
    @apply shadow-2xl shadow-primary/20 border-white/20;
    transform: translateY(-4px);
  }
  
  .book-wrapper {
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .book-nav-item {
    @apply relative w-12 h-16 flex items-center justify-center cursor-pointer duration-300 ease-in-out;
    background: linear-gradient(to right, hsl(var(--book-color-hue, 0), 20%, 30%), hsl(var(--book-color-hue, 0), 25%, 40%));
    border-left: 3px solid hsl(var(--book-color-hue, 0), 30%, 50%);
    box-shadow: inset -3px 0 5px rgba(0,0,0,0.3), 2px 0 4px rgba(0,0,0,0.4);
    transform-origin: center;
  }
  
  .book-nav-item--tool {
    @apply w-12 h-12;
  }

  .book-nav-item::before {
    content: '';
    position: absolute;
    top: 4px;
    bottom: 4px;
    left: 2px;
    width: 2px;
    background: linear-gradient(to bottom, hsl(var(--book-color-hue, 0), 20%, 60%), hsl(var(--book-color-hue, 0), 25%, 40%));
    opacity: 0.7;
    transition: opacity 0.5s ease-out;
  }

  .book-nav-item::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 0px;
    background-color: hsl(var(--book-color-hue, 0), 80%, 85%);
    border-radius: inherit;
    box-shadow: 0 0 8px hsl(var(--book-color-hue, 0), 80%, 85%);
    transition: width 0.5s ease-out, box-shadow 0.5s ease-out;
  }
  
  .book-nav-item.growing {
    animation: book-growing 1s ease-out forwards;
  }
  .book-nav-item.holding {
    animation: book-holding 2s ease-in-out forwards;
  }
  .book-nav-item.climax {
    animation: book-climax 1s ease-in-out forwards;
  }
  .book-nav-item.decaying-on {
    animation: book-decaying-on 1s ease-out forwards;
  }
  .book-nav-item.decaying-off {
    animation: book-decaying-off 1s ease-in forwards;
  }
  
  .book-nav-item.on, .book-nav-item.growing, .book-nav-item.holding, .book-nav-item.climax, .book-nav-item.decaying-on {
    transform: rotateY(20deg);
    box-shadow: 
      inset -3px 0 8px rgba(0,0,0,0.3), 
      0 0 25px hsla(var(--book-color-hue, 0), 50%, 70%, 1),
      0 0 12px hsla(var(--book-color-hue, 0), 50%, 70%, 0.7),
      0 0 5px hsl(var(--book-color-hue, 0), 50%, 80%);
  }

  .book-nav-item.on::after, .book-nav-item.growing::after, .book-nav-item.holding::after, .book-nav-item.climax::after, .book-nav-item.decaying-on::after {
    width: 4px;
  }
  
  .book-cover {
    @apply absolute inset-0 flex items-center justify-center;
    transform: translateZ(2px);
  }

  .book-icon {
    @apply w-6 h-6 text-white/80 transition-opacity duration-300;
    opacity: 0.7;
  }
  
  .book-icon.on {
     opacity: 1;
     animation: active-icon-pulse 2s ease-in-out infinite;
  }

  .page-container-visuals {
     @apply relative w-full;
  }
  
  .page-container-visuals > * {
    --primary: hsl(var(--page-primary-color, 265), 90%, 70%);
    --accent: hsl(var(--page-accent-color, 300), 90%, 70%);
    --ring: hsl(var(--page-primary-color, 265));
  }

  .spell-effect {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  
  .magical-glow {
    color: transparent;
    background-image: linear-gradient(to right, hsl(var(--page-primary-color)), hsl(var(--page-accent-color)));
    text-shadow: 0 0 8px hsl(var(--page-primary-color)), 0 0 16px hsl(var(--page-accent-color));
    background-clip: text;
    -webkit-background-clip: text;
    user-select: none;
  }

  /* ESTRUTURA DE ATRIBUTOS E PERÍCIAS */
  .sub-painel { @apply bg-card/60 border border-white/10 rounded-lg; }
  .atributos-grid-interno { @apply grid grid-cols-2 gap-5; }
  .pericias-lista { @apply flex flex-col; }
  .item-lista { @apply flex flex-col py-2; }
  .item-header { @apply flex justify-between items-center w-full; }
  .item-header .nome { @apply text-base font-semibold; }
  .item-control { @apply w-full pt-3 relative; }

  .pilar-fisico .custo-display b, .pilar-fisico .stepper-value { color: var(--cor-fisico); }
  .pilar-mental .custo-display b, .pilar-mental .stepper-value { color: var(--cor-mental); }
  .pilar-social .custo-display b, .pilar-social .stepper-value { color: var(--cor-social); }
  
  .stepper-container { @apply flex items-center justify-start gap-2; }
  .stepper-btn { @apply h-7 w-7 bg-muted/70 border-none rounded-md text-foreground font-bold cursor-pointer transition-all flex items-center justify-center; }
  .stepper-btn:hover { @apply brightness-125; }
  .stepper-btn:active { @apply scale-95; }
  .stepper-value { @apply font-bold font-headline text-lg min-w-[30px] text-center transition-all; }
  .pilar-fisico .stepper-btn:hover { background-color: var(--cor-fisico); }
  .pilar-mental .stepper-btn:hover { background-color: var(--cor-mental); }
  .pilar-social .stepper-btn:hover { background-color: var(--cor-social); }

  .dots-container { @apply flex gap-2 items-center justify-around p-1; }
  .dot { @apply w-3 h-3 bg-muted/70 cursor-pointer transition-all rounded-sm; transform: rotate(45deg); }
  .dot:hover { transform: rotate(45deg) scale(1.1); }
  .pilar-fisico .dot.selected { background-color: var(--cor-fisico); }
  .pilar-mental .dot.selected { background-color: var(--cor-mental); }
  .pilar-social .dot.selected { background-color: var(--cor-social); }

  .grass-texture {
    background-color: #3a592a;
    background-image: 
        radial-gradient(circle at 100% 0, rgba(82, 128, 59, 0.4) 0%, rgba(82, 128, 59, 0) 10%),
        radial-gradient(circle at 0 50%, rgba(58, 89, 42, 0.2) 0%, rgba(58, 89, 42, 0) 6%),
        radial-gradient(circle at 20% 70%, #52803b 0%, #52803b 1%, transparent 1.2%),
        radial-gradient(circle at 80% 30%, #4a7334 0%, #4a7334 1%, transparent 1.2%),
        radial-gradient(circle at 50% 50%, #41662e 0%, #41662e 0.5%, transparent 0.7%),
        radial-gradient(circle at 30% 20%, #4a7334 0%, #4a7334 1.2%, transparent 1.4%),
        radial-gradient(circle at 70% 90%, #52803b 0%, #52803b 1.5%, transparent 1.7%),
        radial-gradient(circle at 90% 60%, #41662e 0%, #41662e 0.8%, transparent 1%),
        radial-gradient(circle at 10% 10%, #4a7334 0%, #4a7334 1.2%, transparent 1.4%);
    background-size: 100px 100px, 80px 80px, 40px 40px, 50px 50px, 30px 30px, 45px 45px, 55px 55px, 35px 35px, 60px 60px;
  }
}

@layer utilities {
  .hide-number-arrows::-webkit-outer-spin-button,
  .hide-number-arrows::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
  }
  .hide-number-arrows {
      -moz-appearance: textfield;
  }
  .hide-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }

  @keyframes book-growing {
    from { transform: rotateY(0deg); }
    to { transform: rotateY(740deg); } /* 2 spins + 20deg */
  }

  @keyframes book-holding {
    from { 
      transform: rotateY(740deg);
      box-shadow: 
        inset -3px 0 8px rgba(0,0,0,0.3), 
        0 0 20px hsla(var(--book-color-hue, 0), 50%, 70%, 0.8),
        0 0 10px hsla(var(--book-color-hue, 0), 50%, 70%, 0.5),
        0 0 4px hsl(var(--book-color-hue, 0), 50%, 80%); 
    }
    to { 
      transform: rotateY(740deg);
      box-shadow: 
        inset -3px 0 8px rgba(0,0,0,0.3), 
        0 0 40px hsla(var(--book-color-hue, 0), 50%, 70%, 1.5),
        0 0 20px hsla(var(--book-color-hue, 0), 50%, 70%, 1),
        0 0 8px hsl(var(--book-color-hue, 0), 50%, 80%);
    }
  }

  @keyframes book-climax {
    from { 
        transform: rotateY(740deg);
        box-shadow: 
          inset -3px 0 8px rgba(0,0,0,0.3), 
          0 0 40px hsla(var(--book-color-hue, 0), 50%, 70%, 1.5),
          0 0 20px hsla(var(--book-color-hue, 0), 50%, 70%, 1),
          0 0 8px hsl(var(--book-color-hue, 0), 50%, 80%);
    }
    to { 
        transform: rotateY(2180deg); /* 4 more spins */
        box-shadow: 
          inset -3px 0 8px rgba(0,0,0,0.3), 
          0 0 100px hsla(var(--book-color-hue, 0), 60%, 75%, 2),
          0 0 40px hsla(var(--book-color-hue, 0), 60%, 75%, 1.5),
          0 0 15px hsl(var(--book-color-hue, 0), 60%, 85%);
    }
  }
  
  @keyframes book-decaying-on {
    from { 
        transform: rotateY(2180deg); 
        box-shadow: 
          inset -3px 0 8px rgba(0,0,0,0.3), 
          0 0 100px hsla(var(--book-color-hue, 0), 60%, 75%, 2),
          0 0 40px hsla(var(--book-color-hue, 0), 60%, 75%, 1.5),
          0 0 15px hsl(var(--book-color-hue, 0), 60%, 85%);
    }
    to { 
        transform: rotateY(2540deg); /* 1 final spin */
        box-shadow: 
          inset -3px 0 8px rgba(0,0,0,0.3), 
          0 0 25px hsla(var(--book-color-hue, 0), 50%, 70%, 1),
          0 0 12px hsla(var(--book-color-hue, 0), 50%, 70%, 0.7),
          0 0 5px hsl(var(--book-color-hue, 0), 50%, 80%);
    }
  }
  
  @keyframes book-decaying-off {
    from { transform: rotateY(20deg); }
    to { transform: rotateY(-340deg); } /* 1 spin to close */
  }

  @keyframes active-icon-pulse {
    0%, 100% {
      color: hsl(var(--book-color-hue, 0), 80%, 85%);
      filter: drop-shadow(0 0 3px hsl(var(--book-color-hue, 0), 80%, 85%));
    }
    50% {
      color: hsl(var(--book-color-hue, 0), 90%, 90%);
      filter: drop-shadow(0 0 8px hsl(var(--book-color-hue, 0), 80%, 85%));
    }
  }

  /* EFEITOS DE ATRIBUTOS E PERÍCIAS */
  @keyframes shake-hard-diamond { 0%, 100% { transform: translate(0, 0) rotate(45deg); } 10% { transform: translate(-1px, -2px) rotate(44deg); } 20% { transform: translate(-3px, 0px) rotate(46deg); } 30% { transform: translate(3px, 2px) rotate(45deg); } 40% { transform: translate(1px, -1px) rotate(46deg); } 50% { transform: translate(-1px, 2px) rotate(44deg); } 60% { transform: translate(-3px, 1px) rotate(45deg); } 70% { transform: translate(3px, 1px) rotate(44deg); } 80% { transform: translate(-1px, -1px) rotate(46deg); } 90% { transform: translate(1px, 2px) rotate(45deg); } }
  @keyframes sonar-pulse-1 { from { box-shadow: 0 0 0 0px var(--pulse-color); } to { box-shadow: 0 0 0 16px transparent; } }
  @keyframes sonar-pulse-2 { from { box-shadow: 0 0 0 0px var(--pulse-color); } to { box-shadow: 0 0 0 24px transparent; } }
  @keyframes sonar-pulse-3 { from { box-shadow: 0 0 0 0px var(--pulse-color); } to { box-shadow: 0 0 0 32px transparent; } }
  
  @keyframes attribute-pulse { from { text-shadow: 0 0 15px var(--glow-color), 0 0 22px var(--glow-color); } to { text-shadow: 0 0 var(--glow-pulse-distance) var(--glow-color), 0 0 calc(var(--glow-pulse-distance) + 16px) var(--glow-color); } }
  @keyframes tremilique-1 { 0%, 100% { transform: translate(0, 0); } 20% { transform: translate(0.5px, -0.5px); } 40% { transform: translate(-0.5px, 0.5px); } 60% { transform: translate(0.5px, 0.5px); } 80% { transform: translate(-0.5px, -0.5px); } }
  @keyframes tremilique-2 { 0%, 100% { transform: translate(0, 0) rotate(0); } 10% { transform: translate(-1px, -1.5px) rotate(-0.5deg); } 30% { transform: translate(1.5px, 1px) rotate(0.5deg); } 50% { transform: translate(-0.5px, 1.5px) rotate(-0.5deg); } 70% { transform: translate(0.5px, -1px) rotate(0.5deg); } 90% { transform: translate(1.5px, 1px) rotate(0deg); } }
  @keyframes tremilique-3 { 0%, 100% { transform: translate(0, 0) rotate(0); } 10% { transform: translate(-2px, -3px) rotate(-1.5deg); } 20% { transform: translate(3px, 0px) rotate(1.5deg); } 30% { transform: translate(-2px, 2px) rotate(0deg); } 40% { transform: translate(2px, -1px) rotate(1.5deg); } 50% { transform: translate(-1px, 3px) rotate(-1.5deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1.5deg); } 80% { transform: translate(-1px, -2px) rotate(1.5deg); } 90% { transform: translate(2px, 3px) rotate(0deg); } }
  @keyframes tremilique-4 { 0%, 100% { transform: translate(0, 0) rotate(0); } 10% { transform: translate(-4px, -5px) rotate(-3deg); } 20% { transform: translate(5px, 0px) rotate(3deg); } 30% { transform: translate(-4px, 4px) rotate(0deg); } 40% { transform: translate(4px, -2px) rotate(3deg); } 50% { transform: translate(-2px, 5px) rotate(-3deg); } 60% { transform: translate(-5px, 2px) rotate(0deg); } 70% { transform: translate(5px, 2px) rotate(-3deg); } 80% { transform: translate(-2px, -2px) rotate(3deg); } 90% { transform: translate(4px, 5px) rotate(0deg); } }

  .dots-container.shaking .dot.selected { animation: shake-hard-diamond 0.4s infinite ease-in-out; }
  .dots-container.pulsing .dot.selected::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 2px; animation-duration: 1.8s; animation-iteration-count: infinite; animation-delay: inherit; }
  .dots-container.pulsing-1 .dot.selected::after { animation-name: sonar-pulse-1; }
  .dots-container.pulsing-2 .dot.selected::after { animation-name: sonar-pulse-2; }
  .dots-container.pulsing-3 .dot.selected::after { animation-name: sonar-pulse-3; }
  
  .stepper-value.pulsing { animation: attribute-pulse 1.8s infinite alternate ease-in-out; }
  .stepper-value.shaking-1 { animation: tremilique-1 0.15s infinite; }
  .stepper-value.shaking-2 { animation: tremilique-2 0.3s infinite; }
  .stepper-value.shaking-3 { animation: tremilique-3 0.3s infinite; }
  .stepper-value.shaking-4 { animation: tremilique-4 0.4s infinite; }

  .stepper-value[data-glow-level="1"] { text-shadow: 0 0 10px var(--glow-color); } 
  .stepper-value[data-glow-level="2"] { text-shadow: 0 0 12px var(--glow-color), 0 0 16px var(--glow-color); } 
  .stepper-value[data-glow-level="3"] { text-shadow: 0 0 14px var(--glow-color), 0 0 20px var(--glow-color); }
  .stepper-value[data-glow-level="4"] { text-shadow: 0 0 16px var(--glow-color), 0 0 24px var(--glow-color); }
  .stepper-value[data-glow-level="5"] { text-shadow: 0 0 18px var(--glow-color), 0 0 28px var(--glow-color); }
  .stepper-value[data-glow-level="6"] { text-shadow: 0 0 20px var(--glow-color), 0 0 32px var(--glow-color); }
  .stepper-value[data-glow-level="7"] { text-shadow: 0 0 22px var(--glow-color), 0 0 36px var(--glow-color), 0 0 40px var(--glow-color); }
  
  .dots-container[data-glow-level="1"] .dot.selected { --glow-color: var(--pulse-color); box-shadow: 0 0 6px 1px var(--glow-color); }
  .dots-container[data-glow-level="2"] .dot.selected { --glow-color: var(--pulse-color); box-shadow: 0 0 8px 2px var(--glow-color); }
  .dots-container[data-glow-level="3"] .dot.selected { --glow-color: var(--pulse-color); box-shadow: 0 0 11px 3px var(--glow-color); }
  .dots-container[data-glow-level="4"] .dot.selected { --glow-color: var(--pulse-color); box-shadow: 0 0 14px 4px var(--glow-color); }
  .dots-container[data-glow-level="5"] .dot.selected { --glow-color: var(--pulse-color); box-shadow: 0 0 17px 5px var(--glow-color); }

  /* HEALTH PANEL */
    .health-diagram {
        display: grid;
        grid-template-areas:
            "left-arm head right-arm"
            "left-leg torso right-leg";
        grid-template-columns: 1fr auto 1fr;
        gap: 1rem;
        justify-items: center;
        align-items: start;
        width: 100%;
    }

    .body-part-head { grid-area: head; }
    .body-part-torso { grid-area: torso; }
    .body-part-leftArm { grid-area: left-arm; }
    .body-part-rightArm { grid-area: right-arm; }
    .body-part-leftLeg { grid-area: left-leg; }
    .body-part-rightLeg { grid-area: right-leg; }
    
    .body-part-container { @apply flex flex-col items-center gap-2 relative; }
    .icon-container { @apply bg-black/40 rounded-md w-12 h-12 md:w-14 md:h-14 p-1 flex items-center justify-center; }

    .health-grid {
        display: grid;
        grid-template-columns: repeat(var(--grid-cols, 3), 1fr);
        gap: 4px;
        padding: 4px;
        background-color: theme('colors.black / 0.2');
        border-radius: theme('borderRadius.md');
    }
    
    .health-box {
        @apply w-3 h-3 rounded-sm cursor-pointer transition-all duration-200 relative border;
    }
    
    .health-box:hover {
        transform: scale(1.2);
        filter: brightness(1.2);
    }
}
