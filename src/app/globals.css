@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --chart-1: 265 90% 70%;
    --chart-2: 300 90% 70%;
    --chart-3: 198 93% 60%;
    --chart-4: 283 100% 41%;
    --chart-5: 342.1 92.5% 61.4%;
  }

  .dark {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 85.7% 97.3%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --radius: 0rem;
  }
}

@layer base {
  html {
    @apply bg-background;
  }
  html::-webkit-scrollbar {
    display: none;
  }

  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    background: radial-gradient(ellipse at bottom, hsl(var(--background)) 0%, hsl(var(--background) / 0.9) 70%, transparent 100%);
  }

  .hide-number-arrows {
    -moz-appearance: textfield;
  }
  .hide-number-arrows::-webkit-outer-spin-button,
  .hide-number-arrows::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
}

@layer components {
  .glassmorphic-card {
    @apply bg-card/50 backdrop-blur-lg border border-white/10 shadow-lg transition-all duration-300;
  }

  .glassmorphic-card:hover {
    @apply shadow-2xl shadow-primary/20 border-white/20;
    transform: translateY(-4px);
  }

  .book-nav-item {
    @apply relative w-12 flex items-center justify-center cursor-pointer duration-300 ease-in-out;
    background: linear-gradient(to right, hsl(var(--book-color-hue), 20%, 30%), hsl(var(--book-color-hue), 25%, 40%));
    border-left: 3px solid hsl(var(--book-color-hue), 30%, 50%);
    box-shadow: inset -3px 0 5px rgba(0,0,0,0.3), 2px 0 4px rgba(0,0,0,0.4);
    transform-origin: center;
    will-change: transform, box-shadow;
    transform-style: preserve-3d;
    transform: perspective(1000px) rotateY(0deg);
  }

  .book-nav-item.main-book {
    @apply h-16;
  }
  
  .book-nav-item.tool-book {
    @apply h-12;
  }

  .book-nav-item::before {
    content: '';
    position: absolute;
    top: 4px;
    bottom: 4px;
    left: 2px;
    width: 2px;
    background: linear-gradient(to bottom, hsl(var(--book-color-hue), 20%, 60%), hsl(var(--book-color-hue), 25%, 40%));
    opacity: 0;
    transition: opacity 0.5s ease-out;
  }
  
  .book-nav-item.on,
  .book-nav-item.growing,
  .book-nav-item.holding,
  .book-nav-item.climax,
  .book-nav-item.decaying-on {
    transform: perspective(1000px) rotateY(20deg);
  }

  .book-nav-item.on::before {
    opacity: 1;
  }
  
  .book-nav-item.on {
    box-shadow: 
      inset -3px 0 8px rgba(0,0,0,0.3), 
      0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1),
      0 0 12px hsla(var(--book-color-hue), 50%, 70%, 0.7),
      0 0 5px hsl(var(--book-color-hue), 50%, 80%);
  }

  .book-nav-item::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 0px;
    background-color: hsl(var(--book-color-hue), 80%, 85%);
    border-radius: inherit;
    box-shadow: 0 0 8px hsl(var(--book-color-hue), 80%, 85%);
    transition: width 0.5s ease-out;
  }
  
  .book-nav-item.on::after {
    width: 4px;
  }

  .book-icon {
    @apply text-white/80 transition-opacity duration-300;
    opacity: 0;
  }

  .book-nav-item.on .book-icon,
  .book-nav-item.growing .book-icon,
  .book-nav-item.holding .book-icon,
  .book-nav-item.climax .book-icon,
  .book-nav-item.decaying-on .book-icon {
     opacity: 1;
     animation: active-icon-pulse 2s ease-in-out infinite;
  }
  .book-nav-item.on .book-icon {
    animation: none; /* No pulse in final ON state */
  }


  .book-title {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) rotate(90deg);
    font-size: 10px;
    font-weight: bold;
    color: hsl(var(--book-color-hue), 20%, 85%);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    writing-mode: vertical-rl;
    text-orientation: mixed;
    white-space: nowrap;
    opacity: 1;
    transition: opacity 0.3s ease-out;
  }
  
  .book-nav-item.on .book-title,
  .book-nav-item.growing .book-title,
  .book-nav-item.holding .book-title,
  .book-nav-item.climax .book-title,
  .book-nav-item.decaying-on .book-title {
    opacity: 0;
  }
  
  .page-container-visuals {
     @apply relative w-full;
  }
  
  .page-container-visuals > * {
    --primary: hsl(var(--page-primary-color));
    --accent: hsl(var(--page-accent-color));
    --ring: hsl(var(--page-primary-color));
  }

  .spell-effect {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  
  .magical-glow {
    color: transparent;
    background-image: linear-gradient(to right, hsl(var(--page-primary-color, var(--primary))), hsl(var(--page-accent-color, var(--accent))));
    text-shadow: 0 0 8px hsl(var(--page-primary-color, var(--primary))), 0 0 16px hsl(var(--page-accent-color, var(--accent)));
    @apply bg-clip-text select-none;
  }

  /* Animations */
  .book-nav-item.growing { animation: book-growing 1s ease-out forwards; }
  .book-nav-item.holding { animation: book-holding 1s linear infinite; }
  .book-nav-item.climax { animation: book-climax 1s ease-in-out forwards; }
  .book-nav-item.decaying-on { animation: book-decaying-on 1s ease-out forwards; }
  .book-nav-item.decaying-off { animation: book-decaying-off 1s ease-in forwards; }
}

@layer utilities {
  .hide-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  .hide-scrollbar::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera*/
  }

  @keyframes active-icon-pulse {
    0%, 100% {
      color: hsl(var(--book-color-hue), 80%, 85%);
      filter: drop-shadow(0 0 3px hsl(var(--book-color-hue), 80%, 85%));
    }
    50% {
      color: hsl(var(--book-color-hue), 90%, 90%);
      filter: drop-shadow(0 0 8px hsl(var(--book-color-hue), 80%, 85%));
    }
  }

  @keyframes book-growing {
    from {
      transform: perspective(1000px) rotateY(0deg);
      box-shadow: inset -3px 0 5px rgba(0,0,0,0.3), 2px 0 4px rgba(0,0,0,0.4);
    }
    to {
      transform: perspective(1000px) rotateY(20deg);
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1);
    }
  }

  @keyframes book-holding {
    0%, 100% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 12.5px hsla(var(--book-color-hue), 50%, 70%, 0.5);
    }
    50% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 37.5px hsla(var(--book-color-hue), 50%, 70%, 1.5);
    }
  }

  @keyframes book-climax {
    from {
      transform: perspective(1000px) rotateY(20deg);
    }
    50% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 75px hsla(var(--book-color-hue), 50%, 70%, 3);
    }
    to {
      transform: perspective(1000px) rotateY(20deg);
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1);
    }
  }

  @keyframes book-decaying-on {
    from {
      transform: perspective(1000px) rotateY(20deg);
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1);
    }
    to {
      transform: perspective(1000px) rotateY(20deg);
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1);
    }
  }

  @keyframes book-decaying-off {
    from {
      transform: perspective(1000px) rotateY(20deg);
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue), 50%, 70%, 1);
    }
    to {
      transform: perspective(1000px) rotateY(0deg);
      box-shadow: inset -3px 0 5px rgba(0,0,0,0.3), 2px 0 4px rgba(0,0,0,0.4);
    }
  }

}
