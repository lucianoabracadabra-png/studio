@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --chart-1: 265 90% 70%;
    --chart-2: 300 90% 70%;
    --chart-3: 198 93% 60%;
    --chart-4: 283 100% 41%;
    --chart-5: 342.1 92.5% 61.4%;
  }

  .dark {
    --background: 246 30% 6%;
    --foreground: 240 7% 80%;
    --card: 246 30% 12%;
    --card-foreground: 240 7% 80%;
    --popover: 246 30% 6%;
    --popover-foreground: 240 7% 80%;
    --primary: 265 90% 70%;
    --primary-foreground: 240 7% 95%;
    --secondary: 240 10% 20%;
    --secondary-foreground: 240 7% 95%;
    --muted: 240 10% 20%;
    --muted-foreground: 240 5% 55%;
    --accent: 300 90% 70%;
    --accent-foreground: 240 7% 95%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 85.7% 97.3%;
    --border: 240 10% 20%;
    --input: 240 10% 20%;
    --ring: 265 90% 70%;
    --radius: 0.5rem;
  }
}

@layer base {
  html {
    @apply bg-background;
  }
  html::-webkit-scrollbar {
    display: none;
  }

  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
    background: radial-gradient(ellipse at bottom, hsl(var(--background)) 0%, hsl(var(--background) / 0.9) 70%, transparent 100%);
  }

  .hide-number-arrows {
    -moz-appearance: textfield;
  }
  .hide-number-arrows::-webkit-outer-spin-button,
  .hide-number-arrows::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
}

@layer components {
  .glassmorphic-card {
    @apply bg-card/50 backdrop-blur-lg border border-white/10 shadow-lg transition-all duration-300;
  }

  .glassmorphic-card:hover {
    @apply shadow-2xl shadow-primary/20 border-white/20;
    transform: translateY(-4px);
  }
  
  .book-wrapper {
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .book-nav-item {
    @apply relative w-12 h-16 flex items-center justify-center cursor-pointer duration-300 ease-in-out;
    background: linear-gradient(to right, hsl(var(--book-color-hue, 0), 20%, 30%), hsl(var(--book-color-hue, 0), 25%, 40%));
    border-left: 3px solid hsl(var(--book-color-hue, 0), 30%, 50%);
    box-shadow: inset -3px 0 5px rgba(0,0,0,0.3), 2px 0 4px rgba(0,0,0,0.4);
    will-change: transform, box-shadow;
    transform: rotateY(0deg);
  }

  /* Pseudo-element for decorative spine line */
  .book-nav-item::before {
    content: '';
    position: absolute;
    top: 4px;
    bottom: 4px;
    left: 2px;
    width: 2px;
    background: linear-gradient(to bottom, hsl(var(--book-color-hue, 0), 20%, 60%), hsl(var(--book-color-hue, 0), 25%, 40%));
    opacity: 0.7;
    transition: opacity 0.5s ease-out;
  }

  /* Pseudo-element for the glowing edge */
  .book-nav-item::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 0px;
    background-color: hsl(var(--book-color-hue, 0), 80%, 85%);
    border-radius: inherit;
    box-shadow: 0 0 8px hsl(var(--book-color-hue, 0), 80%, 85%);
    transition: width 0.5s ease-out;
  }

  .book-cover {
    @apply absolute inset-0 flex items-center justify-center;
    transform: translateZ(2px); /* Pushes the cover slightly forward */
  }

  .book-icon {
    @apply text-white/80 transition-opacity duration-300;
    opacity: 0.7;
  }
  
  .book-nav-item.on .book-icon,
  .book-nav-item.growing .book-icon,
  .book-nav-item.holding .book-icon,
  .book-nav-item.climax .book-icon,
  .book-nav-item.decaying-on .book-icon {
     opacity: 1;
  }

  .book-nav-item.on .book-icon {
    animation: active-icon-pulse 2s ease-in-out infinite;
  }

  /* State-specific styles */
  .book-nav-item.on,
  .book-nav-item.growing,
  .book-nav-item.holding,
  .book-nav-item.climax,
  .book-nav-item.decaying-on {
    transform: rotateY(20deg);
  }
  
  .book-nav-item.on::before,
  .book-nav-item.growing::before,
  .book-nav-item.holding::before,
  .book-nav-item.climax::before,
  .book-nav-item.decaying-on::before {
    opacity: 1;
  }
  
  .book-nav-item.on {
    box-shadow: 
      inset -3px 0 8px rgba(0,0,0,0.3), 
      0 0 25px hsla(var(--book-color-hue, 0), 50%, 70%, 1),
      0 0 12px hsla(var(--book-color-hue, 0), 50%, 70%, 0.7),
      0 0 5px hsl(var(--book-color-hue, 0), 50%, 80%);
  }
  
  .book-nav-item.on::after,
  .book-nav-item.growing::after,
  .book-nav-item.holding::after,
  .book-nav-item.climax::after,
  .book-nav-item.decaying-on::after {
    width: 4px;
  }

  /* SPINNING LOGIC */
  .book-nav-item.spinning {
    animation-name: book-spin;
    animation-timing-function: ease-in-out;
    animation-fill-mode: forwards;
    animation-duration: var(--book-rotation-duration, 1s);
    animation-iteration-count: var(--book-rotation-count, 1);
    animation-play-state: var(--book-animation-state, paused);
  }
  
  .book-nav-item.holding {
    animation: holding-glow 1s linear infinite;
  }
  
  .book-nav-item.climax {
     animation: climax-glow 1s ease-in-out, book-spin 1s ease-in-out forwards;
     animation-iteration-count: 1, var(--book-rotation-count, 4);
     animation-duration: 1s, var(--book-rotation-duration, 1s);
  }

  
  .page-container-visuals {
     @apply relative w-full;
  }
  
  .page-container-visuals > * {
    --primary: hsl(var(--page-primary-color, 265));
    --accent: hsl(var(--page-accent-color, 300));
    --ring: hsl(var(--page-primary-color, 265));
  }

  .spell-effect {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  
  .magical-glow {
    color: transparent;
    background-image: linear-gradient(to right, hsl(var(--page-primary-color, var(--primary))), hsl(var(--page-accent-color, var(--accent))));
    text-shadow: 0 0 8px hsl(var(--page-primary-color, var(--primary))), 0 0 16px hsl(var(--page-accent-color, var(--accent)));
    @apply bg-clip-text select-none;
  }

}

@layer utilities {
  .hide-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  .hide-scrollbar::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera*/
  }

  @keyframes book-spin {
    from {
      transform: rotateY(0deg);
    }
    to {
      transform: rotateY(360deg);
    }
  }

  @keyframes active-icon-pulse {
    0%, 100% {
      color: hsl(var(--book-color-hue, 0), 80%, 85%);
      filter: drop-shadow(0 0 3px hsl(var(--book-color-hue, 0), 80%, 85%));
    }
    50% {
      color: hsl(var(--book-color-hue, 0), 90%, 90%);
      filter: drop-shadow(0 0 8px hsl(var(--book-color-hue, 0), 80%, 85%));
    }
  }

  @keyframes holding-glow {
    0%, 100% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 12.5px hsla(var(--book-color-hue, 0), 50%, 70%, 0.5);
    }
    50% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 37.5px hsla(var(--book-color-hue, 0), 50%, 70%, 1.5);
    }
  }

  @keyframes climax-glow {
    from {
       box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 37.5px hsla(var(--book-color-hue, 0), 50%, 70%, 1.5);
    }
    50% {
      box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 75px hsla(var(--book-color-hue, 0), 50%, 70%, 3);
    }
    to {
       box-shadow: inset -3px 0 8px rgba(0,0,0,0.3), 0 0 25px hsla(var(--book-color-hue, 0), 50%, 70%, 1);
    }
  }
}
